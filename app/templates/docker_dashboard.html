{% extends "base.html" %} {% block title %}Docker Dashboard{% endblock %} {%
block content %}
<div class="container-fluid">
  <h1 class="mt-4">üê≥ Gestion Docker</h1>

  {% if not installed %}
  <div class="alert alert-warning">
    Docker n'est pas d√©tect√© sur le syst√®me.
    <button class="btn btn-primary btn-sm" onclick="installDocker()">
      Installer Docker
    </button>
  </div>
  {% else %}

  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-white bg-primary mb-3">
        <div class="card-header">Conteneurs MC</div>
        <div class="card-body">
          <h5 class="card-title display-4">{{ containers|length }}</h5>
        </div>
      </div>
    </div>
    <div class="col-md-9">
      <div class="card">
        <div class="card-header">Actions Globales</div>
        <div class="card-body">
          <button class="btn btn-outline-danger" onclick="pruneDocker()">
            Nettoyer Images Inutilis√©es (Prune)
          </button>
          <button class="btn btn-outline-info" onclick="location.reload()">
            Rafra√Æchir
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Conteneurs Minecraft</div>
    <div class="card-body table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Serveur</th>
            <th>Status</th>
            <th>Image</th>
            <th>√âtat</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for c in containers %}
          <tr>
            <td>
              <strong>{{ c.name }}</strong><br />
              <small class="text-muted">{{ c.id }}</small>
            </td>
            <td>{{ c.status_text }}</td>
            <td>{{ c.image }}</td>
            <td>
              {% if c.state == 'running' %}
              <span class="badge badge-success">Running</span>
              {% else %}
              <span class="badge badge-secondary">{{ c.state }}</span>
              {% endif %}
            </td>
            <td>
              <a href="/server/{{ c.name }}" class="btn btn-sm btn-primary"
                >G√©rer</a
              >
              <button
                class="btn btn-sm btn-info"
                onclick="showLogs('{{ c.name }}')"
              >
                Logs
              </button>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center">
              Aucun conteneur Minecraft d√©tect√©
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% endif %}
</div>

<script>
  function installDocker() {
    if (confirm("Lancer l'installation automatique de Docker ?")) {
      fetch("/api/system/install-docker", { method: "POST" })
        .then((res) => res.json())
        .then((data) => alert(data.message));
    }
  }
  function pruneDocker() {
    if (confirm("Supprimer toutes les images non utilis√©es ?")) {
      // Implement prune api call
      alert("Commande envoy√©e");
    }
  }
  function showLogs(name) {
    window.location.href = `/server/${name}#logs`;
  }
</script>
{% endblock %}
